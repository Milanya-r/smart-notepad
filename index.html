<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Умный Блокнот</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.svg" type="image/svg+xml">
    <meta name="theme-color" content="#0891b2">
    <!-- Version 1.0 - All-in-one build -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
      // Prevents Flash of Incorrect Theme (FOIT)
      (function() {
        try {
          var theme = localStorage.getItem('theme');
          if (theme) {
            if (JSON.parse(theme) === 'dark') {
              document.documentElement.classList.add('dark');
            }
          } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
          }
        } catch (_) {}
      })();
    </script>
    <style>
      body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      /* Light theme markdown */
      .markdown-content h1, .markdown-content h2, .markdown-content h3 { color: #1e293b; font-weight: 600; margin-bottom: 0.5em; margin-top: 1em; }
      .markdown-content h1 { font-size: 1.5em; }
      .markdown-content h2 { font-size: 1.25em; }
      .markdown-content h3 { font-size: 1.1em; }
      .markdown-content p { margin-bottom: 0.75em; }
      .markdown-content ul, .markdown-content ol { margin-left: 1.5em; margin-bottom: 1em; }
      .markdown-content ul { list-style-type: disc; }
      .markdown-content ol { list-style-type: decimal; }
      .markdown-content li { margin-bottom: 0.25em; }
      .markdown-content a { color: #0891b2; text-decoration: underline; }
      .markdown-content blockquote { border-left: 4px solid #cbd5e1; padding-left: 1em; margin-left: 0; font-style: italic; color: #475569; }
      .markdown-content code { background-color: #f1f5f9; padding: 0.2em 0.4em; border-radius: 4px; font-family: monospace; }
      .markdown-content pre { background-color: #f1f5f9; padding: 1em; border-radius: 6px; overflow-x: auto; }
      .markdown-content pre code { padding: 0; background-color: transparent; }
      .markdown-content li.task-list-item { list-style-type: none !important; margin-left: -1.5em; }
      .markdown-content li.task-list-item { display: flex; align-items: center; }
      .markdown-content li.task-list-item input[type="checkbox"] { margin-right: 0.75em; appearance: none; width: 1.15em; height: 1.15em; border: 2px solid #94a3b8; border-radius: 4px; cursor: pointer; position: relative; top: -1px; flex-shrink: 0; }
      .markdown-content li.task-list-item input[type="checkbox"]:checked { background-color: #0891b2; border-color: #0891b2; }
      .markdown-content li.task-list-item input[type="checkbox"]:checked::before { content: '✔'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 0.8em; color: #ffffff; }
      .markdown-content li.task-list-item.done { color: #64748b; text-decoration: line-through; }
      
      /* Dark theme markdown */
      .dark .markdown-content h1, .dark .markdown-content h2, .dark .markdown-content h3 { color: #e2e8f0; }
      .dark .markdown-content a { color: #22d3ee; }
      .dark .markdown-content blockquote { border-left-color: #475569; color: #94a3b8; }
      .dark .markdown-content code { background-color: #1e293b; }
      .dark .markdown-content pre { background-color: #1e293b; }
      .dark .markdown-content li.task-list-item input[type="checkbox"] { border-color: #475569; }
      .dark .markdown-content li.task-list-item input[type="checkbox"]:checked { background-color: #22d3ee; border-color: #22d3ee; }
      .dark .markdown-content li.task-list-item input[type="checkbox"]:checked::before { color: #0f172a; }
      .dark .markdown-content li.task-list-item.done { color: #64748b; }
    </style>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>
    <script type="text/babel" data-type="module">
const { useState, useEffect, useMemo, useRef, useCallback } = React;
      
// --- Start of Bundled Code ---

// hooks/useLocalStorage.js
function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      if (typeof window === 'undefined') {
        return initialValue;
      }
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error(error);
      return initialValue;
    }
  });

  useEffect(() => {
    try {
      if (typeof window !== 'undefined') {
        window.localStorage.setItem(key, JSON.stringify(storedValue));
      }
    } catch (error) {
      console.error('Error saving to localStorage', error);
    }
  }, [key, storedValue]);

  useEffect(() => {
    if (typeof window === 'undefined') return;
    
    const handleStorageChange = (e) => {
      if (e.key === key) {
        try {
          if (e.newValue === null) {
            setStoredValue(initialValue);
          } else {
            setStoredValue(JSON.parse(e.newValue));
          }
        } catch (error) {
          console.error('Error parsing stored value on storage event', error);
          setStoredValue(initialValue);
        }
      }
    };

    window.addEventListener('storage', handleStorageChange);
    return () => {
      window.removeEventListener('storage', handleStorageChange);
    };
  }, [key, initialValue]);

  return [storedValue, setStoredValue];
}

// components/icons.js
const PlusIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
  </svg>
);
const StarIcon = ({ className = 'w-6 h-6', filled = false }) => (
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth={1.5} className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
  </svg>
);
const TrashIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12.548 0A48.094 48.094 0 016.25 5.397m11.5 0a48.11 48.11 0 00-7.5 0" />
  </svg>
);
const PencilIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
  </svg>
);
const XMarkIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
  </svg>
);
const FolderPlusIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M12 10.5v6m3-3H9m4.06-7.19-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
    </svg>
);
const ArrowLeftIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
  </svg>
);
const CheckIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12.75l6 6 9-13.5" />
  </svg>
);
const SearchIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
    </svg>
);
const BellIcon = ({ className = 'w-6 h-6', filled = false }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill={filled ? "currentColor" : "none"} viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
  </svg>
);
const EyeIcon = ({ className = 'w-6 h-6' }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
    <path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
  </svg>
);
const EyeSlashIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 0 1-4.293 5.572M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.243 4.243-4.243-4.243" />
    </svg>
);
const ArrowDownTrayIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
    </svg>
);
const ArrowUpTrayIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
    </svg>
);
const Bars3Icon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
    </svg>
);
const ClipboardDocumentCheckIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M10.125 2.25h-4.5c-1.125 0-2.25.9-2.25 2.25v15c0 1.125.9 2.25 2.25 2.25h10.5c1.125 0 2.25-.9 2.25-2.25v-15c0-1.125-.9-2.25-2.25-2.25H13.5m-3.375 0c1.621 0 2.934.624 3.962 1.554a4.5 4.5 0 0 1 1.933 3.512c.394 2.06.134 4.237-.826 6.052a4.5 4.5 0 0 1-1.46 1.46c-1.814.96-3.992 1.22-6.052.826a4.5 4.5 0 0 1-3.512-1.933 4.5 4.5 0 0 1-1.554-3.962c.31-.95.826-1.833 1.554-2.532A4.5 4.5 0 0 1 6.225 7.5c1.03-.51 2.138-.71 3.265-.493m5.25 1.522c.358.07.709.158 1.05.257m-5.466-2.288a.75.75 0 0 0-1.06 0l-1.06 1.06a.75.75 0 0 0 0 1.06l4.5 4.5a.75.75 0 0 0 1.06 0l2.25-2.25a.75.75 0 0 0 0-1.06l-1.06-1.06a.75.75 0 0 0-1.06 0z" />
    </svg>
);
const ArchiveBoxXMarkIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75m12 12.75-3.62-2.228a.75.75 0 0 0-.916.03l-3.62 2.228m10.125-10.125L12 13.5m-1.125-1.125L9.75 11.25m3.375 3.375-1.125-1.125m-2.25 2.25 1.125-1.125M12 13.5l1.125 1.125m-2.25-2.25L9.75 11.25m0 0 1.125 1.125M12 13.5l-1.125 1.125m2.25-2.25 1.125-1.125" />
    </svg>
);
const CheckCircleIcon = ({ className = 'w-6 h-6', filled = false }) => (
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth={1.5} className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
);
const PinIcon = ({ className = 'w-6 h-6', filled = false }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill={filled ? "currentColor" : "none"} viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
    </svg>
);
const PaintBrushIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M9.53 16.122a3 3 0 0 0-2.818.172l-1.172 1.172a3 3 0 0 0 4.242 4.242l1.172-1.172a3 3 0 0 0 .172-2.818l-.172-.172a3 3 0 0 0-4.242 0l-1.172 1.172a3 3 0 0 0 4.242 4.242l1.172-1.172a3 3 0 0 0 2.818-.172l.172-.172a3 3 0 0 0 0-4.242l-1.172-1.172a3 3 0 0 0-4.242 0Z" />
        <path strokeLinecap="round" strokeLinejoin="round" d="M12.31 16.31 8.865 12.865m0 0a3 3 0 0 1 0-4.242l1.172-1.172a3 3 0 0 1 4.242 0l1.172 1.172a3 3 0 0 1 0 4.242l-1.172-1.172a3 3 0 0 1-4.242 0Zm-2.818-4.242a3 3 0 0 0 0 4.242l1.172 1.172a3 3 0 0 0 4.242 0l1.172-1.172a3 3 0 0 0 0-4.242l-1.172-1.172a3 3 0 0 0-4.242 0l-1.172 1.172Z" />
    </svg>
);
const ArrowUturnLeftIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" />
    </svg>
);
const Cog6ToothIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.26.716.53 1.003l.823.823c.374.374.88.554 1.395.45l1.27-.21c.542-.09.993.256.993.796v2.593c0 .54-.45.986-.993.986l-1.27.21c-.515.104-1.02.276-1.395.65l-.823.823c-.27.287-.467.629-.53 1.003l-.213 1.282c-.09.541-.56.939-1.11.939h-2.593c-.55 0-1.02-.398-1.11-.939l-.213-1.281c-.063-.374-.26-.716-.53-1.003l-.823-.823c-.374-.374-.88-.554-1.395-.45l-1.27.21c-.542.09-.993-.256-.993.796V8.34c0-.54.45-.986.993.986l1.27-.21c.515-.104 1.02-.276 1.395-.65l.823.823c.27-.287.467.629-.53-1.003l.213-1.282Z" />
        <path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
    </svg>
);
const LockClosedIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
    </svg>
);
const EllipsisVerticalIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
    </svg>
);
const SunIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
    </svg>
);
const MoonIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" />
    </svg>
);
const DocumentDuplicateIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H9.75" />
    </svg>
);
const BoldIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 6.75h4.5a3.375 3.375 0 0 1 3.375 3.375v1.5a3.375 3.375 0 0 1-3.375 3.375h-4.5V6.75Z" />
        <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 15h6a3.375 3.375 0 0 1 3.375 3.375v0a3.375 3.375 0 0 1-3.375 3.375h-6V15Z" />
    </svg>
);
const ItalicIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M16.875 3.75h-1.5-1.5-1.5-1.5-1.5M16.875 3.75h-1.5-1.5-1.5-1.5-1.5-1.5m1.5 0-4.5 16.5m1.5-16.5L12 20.25m4.875-16.5-4.5 16.5m0 0H9.375m0 0h-1.5-1.5-1.5-1.5-1.5m1.5 16.5H9.375m-1.5 0H6.375" />
    </svg>
);
const HeadingIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 3.75v16.5M6 3.75h12M6 20.25h12M15 3.75v16.5" />
    </svg>
);
const LinkIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244" />
    </svg>
);
const CodeBracketIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5" />
    </svg>
);
const ListBulletIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm0 5.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm0 5.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
    </svg>
);
const ListOrderedIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
    </svg>
);
const QuoteIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 4.5l-4.5 4.5v10.5h10.5v-10.5l-4.5-4.5H8.25Zm4.5 0-4.5 4.5v10.5h10.5v-10.5l-4.5-4.5h-1.5Z" />
    </svg>
);
const ShareIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 0-2.186 2.25 2.25 0 0 0 0 2.186Zm0-12.783a2.25 2.25 0 1 0 0-2.186 2.25 2.25 0 0 0 0 2.186Z" />
    </svg>
);
const ClockIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
    </svg>
);
const CalendarDaysIcon = ({ className = 'w-6 h-6' }) => (
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0h18" />
    </svg>
);

const App = () => {
  const [notes, setNotes] = useLocalStorage('notes', []);
  const [categories, setCategories] = useLocalStorage('categories', [{ id: 'all', name: 'Все заметки' }]);
  const [activeNoteId, setActiveNoteId] = useState(null);
  const [activeCategoryId, setActiveCategoryId] = useState('all');
  const [searchTerm, setSearchTerm] = useState('');
  const [isSidebarVisible, setSidebarVisible] = useState(false);
  const [theme, setTheme] = useLocalStorage('theme', 'system');

  useEffect(() => {
    if (theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }, [theme]);
  
  const createNewNote = (content = '') => {
    const newNote = {
      id: Date.now().toString(),
      title: 'Новая заметка',
      content: content,
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
      categoryId: activeCategoryId === 'all' ? (categories[1]?.id || null) : activeCategoryId,
      isFavorite: false,
    };
    setNotes(prev => [newNote, ...prev]);
    setActiveNoteId(newNote.id);
    if (window.innerWidth < 768) {
        setSidebarVisible(false);
    }
  };

  useEffect(() => {
      const handleUrlActions = () => {
          const params = new URLSearchParams(window.location.search);
          const hash = window.location.hash;
          
          if (hash === '#new-note') {
              createNewNote();
              history.pushState("", document.title, window.location.pathname + window.location.search);
          } else if (params.has('text') || params.has('title')) {
              const sharedText = params.get('text') || '';
              const sharedTitle = params.get('title') || 'Заметка извне';
              createNewNote(`${sharedTitle}\n\n${sharedText}`);
              history.pushState({}, '', window.location.pathname);
          }
      };
      
      handleUrlActions();
      window.addEventListener('hashchange', handleUrlActions);
      
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            const swUrl = `${window.location.origin}/service-worker.js`;
            navigator.serviceWorker.register(swUrl)
              .then(reg => console.log('Service Worker registered successfully:', reg))
              .catch(err => console.error('Service Worker registration failed:', err));
        });
      }

      return () => {
          window.removeEventListener('hashchange', handleUrlActions);
      };
  }, []);

  const updateNote = (id, updatedFields) => {
    setNotes(notes.map(note => 
      note.id === id ? { ...note, ...updatedFields, updatedAt: new Date().toISOString() } : note
    ));
  };
  
  const deleteNote = (id) => {
    setNotes(notes.filter(note => note.id !== id));
    if (activeNoteId === id) {
      setActiveNoteId(null);
    }
  };

  const activeNote = useMemo(() => notes.find(note => note.id === activeNoteId), [notes, activeNoteId]);

  const filteredNotes = useMemo(() => {
    return notes
      .filter(note => {
        const inCategory = activeCategoryId === 'all' || note.categoryId === activeCategoryId;
        const matchesSearch = searchTerm.trim() === '' || 
          note.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
          note.content.toLowerCase().includes(searchTerm.toLowerCase());
        return inCategory && matchesSearch;
      })
      .sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());
  }, [notes, activeCategoryId, searchTerm]);

  const getSanitizedHtml = (markdown) => {
    const rawHtml = marked.parse(markdown, { gfm: true, breaks: true });
    const withTasks = rawHtml.replace(/<li>\[ \] (.*?)<\/li>/g, '<li class="task-list-item"><input type="checkbox" disabled> $1</li>')
                             .replace(/<li>\[x\] (.*?)<\/li>/g, '<li class="task-list-item done"><input type="checkbox" checked disabled> $1</li>');
    return DOMPurify.sanitize(withTasks);
  };
  
  return (
    <div className="flex h-screen bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200 font-sans overflow-hidden">
      {/* Sidebar */}
      <aside className={`w-80 bg-white dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 flex flex-col transition-transform duration-300 ${isSidebarVisible ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0 md:relative absolute z-20 h-full`}>
        <div className="p-4 flex justify-between items-center border-b border-slate-200 dark:border-slate-700">
          <h1 className="text-xl font-bold text-cyan-600">Умный Блокнот</h1>
          <button onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')} className="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700">
            {theme === 'dark' ? <SunIcon className="w-5 h-5" /> : <MoonIcon className="w-5 h-5" />}
          </button>
        </div>
        <div className="p-4">
          <button onClick={() => createNewNote()} className="w-full flex items-center justify-center gap-2 bg-cyan-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-cyan-700 transition-colors">
            <PlusIcon className="w-5 h-5" />
            Новая заметка
          </button>
        </div>
        <div className="p-4">
          <div className="relative">
            <SearchIcon className="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" />
            <input 
              type="text"
              placeholder="Поиск..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full bg-slate-100 dark:bg-slate-700 border border-transparent rounded-lg pl-10 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-cyan-500"
            />
          </div>
        </div>
        <nav className="flex-1 overflow-y-auto px-2">
          <ul>
            {categories.map(cat => (
              <li key={cat.id}>
                <a 
                  href="#"
                  onClick={(e) => { e.preventDefault(); setActiveCategoryId(cat.id); setSidebarVisible(false); }}
                  className={`flex items-center gap-3 px-3 py-2 rounded-md font-medium text-sm ${activeCategoryId === cat.id ? 'bg-cyan-100 dark:bg-cyan-900/50 text-cyan-700 dark:text-cyan-300' : 'hover:bg-slate-100 dark:hover:bg-slate-700'}`}
                >
                  {cat.name}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </aside>

      {/* Note List */}
      <div className={`w-full flex-shrink-0 flex-col border-r border-slate-200 dark:border-slate-700 md:w-96 ${activeNoteId ? 'hidden md:flex' : 'flex'}`}>
         <div className="p-4 border-b border-slate-200 dark:border-slate-700 flex-shrink-0 flex items-center justify-between h-16">
            <div>
              <h2 className="text-lg font-semibold">{categories.find(c => c.id === activeCategoryId)?.name || 'Заметки'}</h2>
              <p className="text-sm text-slate-500">{filteredNotes.length} заметок</p>
            </div>
            <button onClick={() => setSidebarVisible(true)} className="md:hidden p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700">
              <Bars3Icon className="w-6 h-6"/>
            </button>
         </div>
         <div className="overflow-y-auto flex-1">
            {filteredNotes.map(note => (
              <div 
                key={note.id} 
                onClick={() => { setActiveNoteId(note.id); }}
                className={`p-4 border-b border-slate-200 dark:border-slate-700 cursor-pointer ${activeNoteId === note.id ? 'bg-cyan-50 dark:bg-slate-800' : 'hover:bg-slate-100 dark:hover:bg-slate-800/50'}`}
              >
                  <div className="flex justify-between items-start">
                    <h3 className="font-semibold text-slate-800 dark:text-slate-100 truncate pr-2">{note.title}</h3>
                    <StarIcon filled={note.isFavorite} className={`w-5 h-5 flex-shrink-0 ${note.isFavorite ? 'text-yellow-400' : 'text-slate-400'}`} />
                  </div>
                  <p className="text-sm text-slate-500 dark:text-slate-400 line-clamp-2 mt-1">
                    {note.content.length > 100 ? note.content.substring(0, 100) + '...' : note.content || 'Нет дополнительного текста'}
                  </p>
                  <p className="text-xs text-slate-400 mt-2">{new Date(note.updatedAt).toLocaleString()}</p>
              </div>
            ))}
         </div>
      </div>
      
      {/* Main Content */}
      <main className={`flex-1 flex-col ${activeNoteId ? 'flex' : 'hidden md:flex'}`}>
        {activeNote ? (
          <div className="flex-1 flex flex-col min-w-0 h-full">
            {/* Editor Header */}
            <header className="flex-shrink-0 p-2 h-16 flex items-center justify-between border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800">
               <div className="flex items-center gap-2 min-w-0">
                  <button onClick={() => setActiveNoteId(null)} className="md:hidden p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700">
                    <ArrowLeftIcon className="w-6 h-6"/>
                  </button>
                  <input 
                    type="text" 
                    value={activeNote.title}
                    onChange={(e) => updateNote(activeNote.id, { title: e.target.value })}
                    className="text-lg font-semibold bg-transparent focus:outline-none focus:ring-0 border-0 p-1 w-full truncate"
                  />
               </div>
               <div className="flex items-center gap-2 flex-shrink-0">
                 <button onClick={() => updateNote(activeNote.id, { isFavorite: !activeNote.isFavorite })} className="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700">
                    <StarIcon filled={activeNote.isFavorite} className={`w-5 h-5 ${activeNote.isFavorite ? 'text-yellow-400' : 'text-slate-500'}`} />
                 </button>
                 <button onClick={() => deleteNote(activeNote.id)} className="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700">
                   <TrashIcon className="w-5 h-5 text-slate-500" />
                 </button>
               </div>
            </header>
            
            {/* Editor Panes */}
            <div className="flex-1 flex h-full overflow-hidden">
               <div className="w-1/2 h-full flex flex-col">
                  <textarea
                    value={activeNote.content}
                    onChange={(e) => updateNote(activeNote.id, { content: e.target.value })}
                    className="w-full h-full p-6 bg-white dark:bg-slate-800 text-base resize-none focus:outline-none leading-relaxed"
                    placeholder="Начните писать..."
                  ></textarea>
               </div>
               <div className="w-1/2 h-full border-l border-slate-200 dark:border-slate-700 overflow-y-auto">
                 <div
                   className="p-6 markdown-content"
                   dangerouslySetInnerHTML={{ __html: getSanitizedHtml(activeNote.content) }}
                 />
               </div>
            </div>

          </div>
        ) : (
          <div className="flex-1 flex flex-col items-center justify-center text-center text-slate-500 dark:text-slate-400 p-4">
            <DocumentDuplicateIcon className="w-24 h-24 text-slate-300 dark:text-slate-600" />
            <h2 className="mt-4 text-xl font-medium">Выберите заметку для просмотра</h2>
            <p className="mt-1">Или создайте новую, чтобы начать.</p>
          </div>
        )}
      </main>
    </div>
  );
};


const container = document.getElementById('root');
const root = ReactDOM.createRoot(container);
root.render(<App />);

// --- End of Bundled Code ---
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>